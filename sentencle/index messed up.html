<!DOCTYPE html>
<html>

<head>
  <title>Sentencle</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@700&display=swap" rel="stylesheet">
    <link rel="icon" href="./favicon2.png?v=2"></link>

    <meta name="viewport" content="initial-scale=1.0,width=device-width" /></meta>

  <link rel="stylesheet" href="style.css"></link>
  
</head>
<body onLoad="makeAll()" onresize="redraw()" onkeydown="keyPress(event)" onkeyup="keyLightLetter(event)" ontouchstart="disableClicks()">
    <script src="./sentences.txt"></script>
    <script>
        var today = new Date();
        var dd = String(today.getDate()).padStart(2, '0');
        var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
        var yyyy = today.getFullYear();

        var sideBySide;
        var menuOpen = false;
        var pwHeight;
        var pwWidth;
        var mbHeight;
        var kTop;
        var kLeft;
        var kHeight;
        var keySize;
        var keySpacing = 0.1;
        var keyBorder = 0.25;
        var currentGuess = "";
        var cgHeight;
        var letterSize;
        var letterSpacing = 0.1;
        var letterBorder = 0.25;
        var cgWidth;
        var keyboardCollapse = false;
        var goalSentence;
        var recentLetter;
        var menuOpen;
        var endscreenClosed = false;
        var key1 = new Audio('./KeyPress1.mp3');
        //key1.volume = 0.3;
        var key12 = new Audio('./KeyPress1.mp3');
        var key13 = new Audio('./KeyPress1.mp3');
        var key14 = new Audio('./KeyPress1.mp3');
        var key2 = new Audio('./KeyPress2.mp3');
        var key22 = new Audio('./KeyPress2.mp3');
        var key23 = new Audio('./KeyPress2.mp3');
        var key24 = new Audio('./KeyPress2.mp3');
        var doink = new Audio('./doink.mp3');
        var doink2 = new Audio('./doink.mp3');
        var doink3 = new Audio('./doink.mp3');
        var doink4 = new Audio('./doink.mp3');
        var winJingle = new Audio('./winJingle.mp3');
        var SoundOn = true;
        var Clicks = true;
        function disableClicks(){
            Clicks = false;
        }
        function playOneOf(l){
            let i = 0;
            for (i = 0; i < l.length; i++){
                let sound = l[i];
                //sound.load();
                if (sound.currentTime == 0 || sound.ended){
                    if (sound.ended){
                        sound.load();
                    }
                    sound.volume = 0.08;
                    sound.play();
                    return true;
                    }
                }
                return false;
        }
        function playSound(sound){
            if (SoundOn){
                //sound2 = sound.cloneNode();
                //sound2.play();
                if (sound == key1 && Clicks){
                playOneOf([key1, key12, key13, key14]);

                }
                else if (sound == key2 && Clicks){
                playOneOf([key2, key22, key23, key24]);

                }
                else if (sound == doink && Clicks){
                playOneOf([doink, doink2, doink3, doink4]);

                }
                else if (sound == winJingle) {
                playOneOf([winJingle]);
                }
            }
        }
        function setCookie(cname, cvalue) {
            var d = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59);
            //d.setHours(24,0,0,0);
            let expires = "expires=" + d.toGMTString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

        function getCookie(cname) {
        let name = cname + "=";
        let ca = document.cookie.split(';');
        for(let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
            }
            return "";
        }

        window.addEventListener('keydown', function(e) {
        if(e.keyCode == 32 && e.target == document.body) {
            e.preventDefault();
        }
        });
        function newDiv(name){
            return "<div id=" + name + "></div>";
        }
        function keyPress(e){
            let k = e.key;
            if ("qwertyuiopasdfghjklzxcvbnm?.!,".includes(k.toLowerCase())){
                press(k.toUpperCase());
                if (!keyboardCollapse || "?.!".includes(k.toLowerCase())){
                    darkLetter(k.toUpperCase());
                }
            }
            else if (k == " "){
                press(k.toUpperCase());
                if (!keyboardCollapse){
                    darkLetter("3");
                }
            }
            else if (k == "'"){
                press(k.toUpperCase());
                if (!keyboardCollapse){
                darkLetter("1");}
            }
            else if (k == "Enter"){
                press("2");
                if (!keyboardCollapse){
                darkLetter("2");}
            }
            else if (k == "Backspace"){
                press("4");
                if (!keyboardCollapse){
                darkLetter("4");}
            }
        }
        function answer(guess){
            let trueAnswer = goalSentence;
            let i = 0;
            let revealed = "";
            let firstWrong = getCookie("firstWrong").split("-");
            while (i < guess.length && trueAnswer.includes(guess[i])){
                revealed += guess[i];
                i += 1;
            }
            firstWrong.push(i);
            setCookie("firstWrong", firstWrong.join("-"));
            let ret = "";
            for (letter of trueAnswer){
                if (revealed.includes(letter)){
                    ret += letter;
                }
                else if (ret.length == 0 || ret[ret.length - 1] != "*"){
                    ret += "*";
                }
            }
            if (ret == trueAnswer){
                setCookie("gameOver", "true");
                makeAll();
            }
            return ret;

        }
        function cursorError(){
            let c = document.getElementById("cursor");
            playSound(doink);
            c.style.animation = "blink";
            c.style.animationDuration = "1s";
            c.style.animationIterationCount = "infinite";
            window.setTimeout(function() {
                c.style.animation = "blink, turn-red";
                c.style.animationDuration = "1s, 2s";
                c.style.animationIterationCount = "infinite, 1";
            }, 50);
        }
        function press(text){
            if (getCookie("gameOver") == "true"){
                if ("423 ".includes(text)){
                    playSound(key2);
                }
                else{
                    playSound(key1);
                }
                return;
            }
            if (text == "4"){ //backspace
                if (currentGuess != ""){
                    currentGuess = currentGuess.substr(0, currentGuess.length - 1);
                    playSound(key2);
                    makeCurrentGuess();
                    sizeCurrentGuess();
                    sizeHistory();
                }
                else{
                    cursorError();
                }
            }
            else if (text == "2"){ //press enter
                if (currentGuess != ""){
                    let guessHistory = getCookie("guessHistory").split("-");
                    guessHistory.push(currentGuess);
                    setCookie("guessHistory", guessHistory.join("-"));
                    let answerHistory = getCookie("answerHistory").split("-");
                    answerHistory.push(answer(currentGuess));
                    setCookie("answerHistory", answerHistory.join("-"));
                    currentGuess = "";
                    playSound(key2);
                    makeCurrentGuess();
                    sizeCurrentGuess();
                    makeHistory();
                    sizeHistory();
                    sizeCurrentGuess();
                    sizeHistory();
                }
                else{
                    cursorError();
                }
                
            }
            else if (text == "1"){ //quote
                if (currentGuess.length > 59){
                    cursorError();
                    return;
                }
                playSound(key1);
                currentGuess += "'";
                makeCurrentGuess();
                sizeCurrentGuess();
                sizeHistory();
            }
            else if (text == "3" || text == " "){ //space
                if (currentGuess.length > 59){
                    cursorError();
                    return;
                }
                playSound(key2);
                currentGuess += " ";
                makeCurrentGuess();
                sizeCurrentGuess();
                sizeHistory();
            }
            else if (text == "5"){ // collapse keyboard
                keyboardCollapse = !keyboardCollapse;
                makeKeys();
                redraw();
            }
            else{ //normal letters
                if (currentGuess.length > 59){
                    cursorError();
                    return;
                }
                playSound(key1);
                currentGuess += text;
                makeCurrentGuess();
                sizeCurrentGuess();
                sizeHistory();
            }
        }
        function mouseClickLetter(p){
            if (recentLetter != p){
                press(p);
            }
            else{
                recentLetter = "~";
            }
        }
        function darkLetter(p){
            document.getElementById(p).style.backgroundColor = "#2d2d2d";
        }
        function mouseDarkLetter(p){
            if (recentLetter != p){
                darkLetter(p);
            }
        }
        function mobileDarkLetter(p){
            recentLetter = p;
            darkLetter(p);
        }
        
        function mobileClickLetter(p){
            //lightLetter(p);
            press(p);
        }
        function keyLightLetter(e){
            let k = e.key;
            //console.log(k);
            if ("?.!".includes(k) || !keyboardCollapse){
                if (k == "Backspace"){ //backspace
                    lightLetter("4");
                    //console.log("backspacing...");
                }
                else if (k == "Enter"){
                    lightLetter("2");
                }
                else if (k == " "){
                    lightLetter("3");
                }
                else if (k == "'"){
                    lightLetter("1");
                }
                else if ("qwertyuiopasdfghjklzxcvbnm?.!,".includes(k)){
                    lightLetter(k.toUpperCase());
                }
            }
        }
        function lightLetter(p){
            document.getElementById(p).style.backgroundColor = "#631f1f";
        }
        function newButton(name){
            let inner = name;
            let pressed = name;
            if (name == "1"){
                inner = "'";
            }
            else if (name == "2"){
                inner = "Enter";
            }
            else if (name == "3"){
                inner = "";
            }
            else if (name == "4"){
                inner = "Backspace";
            }
            else if (name == "5"){
                inner = "";
            }
            let md = " onmousedown=\"mouseClickLetter('" + pressed + "')\"";
            //let mov = " onmouseover=\"mouseDarkLetter('" + pressed + "')\"";
            //let mo = " onmouseout=\"lightLetter('" + pressed + "')\"";
            //let ts = " ontouchstart=\"mobileDarkLetter('" + pressed + "')\"";
            let te = " ontouchend=\"mobileClickLetter('" + pressed + "')\"";
            return "<button type='button' " + md + te + "\
            class='button' \
            id='" + name + "'>" + inner + "</button>";
            document.getElementById(name).addEventListener('touchend', event => {
                event.preventDefault();
            });
            
        }
        function newLetter(name, i){
            return "<div \
            class='letter' \
            id='" + i + "'>" + name + "</div>";
        }
        function setLocation(el, t, l){
            el.style.top = t.toString() + "px";
            el.style.left = l.toString() + "px";
        }
        function setSize(el, h, w){
            el.style.height = h.toString() + "px";
            el.style.width = w.toString() + "px";
        }
        function sizeMenu(){
            let t = document.getElementById("title");
            let twidth = window.innerWidth * 0.6;
            let theight = twidth / 9;
            if (theight > mbHeight * 0.8){
                theight = mbHeight * 0.8;
                twidth = theight * 9;
            }
            setSize(t, theight, Math.ceil(theight) * 9);
            sizeLetters(t, theight, theight, 0);
            hb = document.getElementById("hamburger");
            setSize(hb, theight, theight);
            hb.style.position = "absolute";
            setLocation(hb, mbHeight / 2 - theight / 2, mbHeight / 2 - theight / 2);
            let slice;
            for (let i = 0; i < 3; i++){
                slice = document.getElementById("slice" + i.toString());
                setSize(slice, theight / 5, theight);
                slice.style.marginBottom = (theight / 5).toString() + "px";
                slice.style.borderRadius = (theight / 10).toString() + "px";
            }
            let m = document.getElementById("menu");
            if (menuOpen){
                if (sideBySide){
                    m.style.width = (pwWidth / 3).toString() + "px";
                }
                else{
                    m.style.width = (pwWidth * 2 / 3).toString() + "px";
                }
                m.style.height = (pwHeight).toString() + "px";
                m.style.position = "absolute";
                setLocation(m, mbHeight, 0);
                m.style.paddingTop = (theight).toString() + "px";
                //m.style.paddingLeft = theight / 2;
                let hm = document.getElementById("menuHint");
                setSize(hm, theight, Math.ceil(theight) * "HINT".length);
                for (l of hm.getElementsByClassName("letter")){
                    setSize(l, theight, theight);
                    l.style.fontSize = (theight * 0.75).toString() + "px";
                }
                hm.style.marginBottom = (theight).toString() + "px";
                let rm = document.getElementById("menuRules");
                setSize(rm, theight, Math.ceil(theight) * "RULES".length);
                for (l of rm.getElementsByClassName("letter")){
                    setSize(l, theight, theight);
                    l.style.fontSize = (theight * 0.75).toString() + "px";
                }
                rm.style.marginBottom = (theight).toString() + "px";
                let cm = document.getElementById("menuClose");
                setSize(cm, theight, Math.ceil(theight) * "CLOSE".length);
                cm.style.top = (theight * 2).toString() + "px";
                for (l of cm.getElementsByClassName("letter")){
                    setSize(l, theight, theight);
                    //l.style.top = (5 * theight).toString() + "px";
                    l.style.fontSize = (theight * 0.75).toString() + "px";
                }
            }
            else{
                m.style.width = "0px";
            }
            let sb = document.getElementById("soundButton");
            setSize(sb, theight, theight);
            setLocation(sb, (mbHeight - theight) / 2, window.innerWidth - theight - (mbHeight - theight) / 2);
        }
        function sizeMenuBar(){
            let mb = document.getElementById("menuBar");
            setSize(mb, mbHeight, window.innerWidth);
            
        }
        function sizePlayWindow(){
            let mb = document.getElementById("menuBar");
            let pw = document.getElementById("playWindow");
            setLocation(pw, mbHeight, 0);
            setSize(pw, pwHeight, pwWidth);
        }
        function sizeHistory(){
            let total = 0;
            let h = document.getElementById("history");
            let pw = document.getElementById("playWindow");
            let hWidth = pwWidth;
            if (sideBySide){
                hWidth /= 2;
                setLocation(h, 0, 0); 
                setSize(h, pwHeight, hWidth);
            }
            else{
                setLocation(h, cgHeight, kLeft);
                setSize(h, pwHeight, hWidth);
            }
            let lettersInALine = 12;
            let ht;
            let wh;
            let rows;
            let answerBoxes = document.getElementsByClassName("answerBox");
            let answerHistory = getCookie("answerHistory").split("-");
            for (let i = answerBoxes.length - 1; i >= 0; i--){
                answerBox = answerBoxes[i];
                rows = Math.max(1, Math.ceil(answerHistory[answerBoxes.length - i].length / 12));
                wh = hWidth;
                ht = rows * letterSize + (rows - 1) * letterSpacing * letterSize + 2 * letterBorder * letterSize;
                setSize(answerBox, ht, wh);
                answerBox.style.paddingTop = (letterBorder * letterSize).toString() + "px";
                answerBox.style.paddingLeft = (letterBorder * letterSize).toString() + "px";
                total += ht;
            }
            let guessBoxes = document.getElementsByClassName("guessBox");
            let guessHistory = getCookie("guessHistory").split("-");
            for (let i = guessBoxes.length - 1; i >= 0; i--){
                guessBox = guessBoxes[i];
                rows = Math.max(1, Math.ceil(guessHistory[guessBoxes.length - i].length / 12));
                wh = hWidth;
                ht = rows * letterSize + (rows - 1) * letterSpacing * letterSize + 2 * letterBorder * letterSize;
                guessBox.style.paddingTop = (letterBorder * letterSize).toString() + "px";
                guessBox.style.paddingLeft = (letterBorder * letterSize).toString() + "px";
                setSize(guessBox, ht, wh);
                total += ht;
            }
            if (!sideBySide){
                setSize(h, Math.max(total+ kHeight + keySize + keySize*keySpacing, pwHeight - cgHeight), pwWidth);
            }
            else{
                setSize(document.getElementById("currentGuess"), Math.max(total, pwHeight), cgWidth);
            }
            sizeLetters(h);
        }
        function sizeLetters(domain, h = letterSize, w = letterSize, mr = letterSize * letterSpacing){
            let letters = domain.getElementsByClassName("letter");
            //letterSize = pwHeight / 10;
            for (letter of letters){
                setSize(letter, h, w);
                letter.style.fontSize = (h * 0.75).toString() + "px";
                letter.style.marginRight = (mr).toString() + "px";
                letter.style.marginBottom = (mr).toString() + "px";
            }
        }
        function sizeCurrentGuess(){
            let cg = document.getElementById("currentGuess");
            let pw = document.getElementById("playWindow");
            cgWidth = pwWidth / 2;
            cgHeight = pwHeight;
            if (sideBySide){
                setLocation(cg, 0, window.innerWidth / 2);
                setSize(cg, pwHeight, cgWidth);
            }
            else{
                cgWidth = pwWidth;
                //cgHeight /= 2;
                setLocation(cg, 0, 0);
            }
            let numLetters = 12;
            letterSize = cgWidth / (2 * letterBorder + (numLetters - 1) * letterSpacing + numLetters);
            if (!sideBySide){
                let j = Math.max(1, Math.ceil(currentGuess.length / 12));
                cgHeight = j * letterSize + (j - 1) * letterSpacing * letterSize + 2 * letterBorder * letterSize;
                setSize(cg, cgHeight, cgWidth);
            }
            cg.style.paddingTop = (letterSize * letterBorder).toString() + "px";
            cg.style.paddingLeft = (letterSize * letterBorder).toString() + "px";
            let cursor = document.getElementById("cursor");
            setSize(cursor, letterSize, letterSize * 0.07);
            sizeLetters(cg);
        }
        function sizeKeys(keySize){
            let keyHeight = keySize * 1.33;
            let buttons = document.getElementsByClassName("button");
            for (button of buttons){
                if (button.id == "2"){
                    setSize(button, keyHeight, keySize * (2 + keySpacing)); 
                    button.style.fontSize = (keySize * 0.33).toString() + "px";
                }
                else if (button.id == "4"){
                    setSize(button, keyHeight, keySize * (2 + keySpacing)); 
                    button.style.fontSize = (keySize * 0.33).toString() + "px";
                }
                else if (button.id == "3"){
                    setSize(button, keyHeight, keySize * (8 + 7 * keySpacing)); 
                }
                else{
                    setSize(button, keyHeight, keySize);
                    button.style.fontSize = (keySize * 0.75).toString() + "px";
                }
                button.style.marginRight = (keySize * keySpacing).toString() + "px";
                button.style.marginBottom = (keySize * keySpacing).toString() + "px";
                button.style.borderRadius = (keySize / 7).toString() + "px";
            }
        }
        function sizeKeyboard(){
            
            let k = document.getElementById("keyboard");
            let kWidth = pwWidth;
            kLeft = 0;
            if (sideBySide){
                kWidth /= 2;
                kLeft = pwWidth / 2;
            }
            let ratio = (4 * 1.33 + 3 * keySpacing + 2 * keyBorder) / (10 + 9 * keySpacing + 2 * keyBorder);
            let keyHeight;
            if (keyboardCollapse){
                kTop = window.innerHeight * 0.98;
                kHeight = window.innerHeight * 0.02;
                keySize = kWidth * ratio / (4 * 1.33 + 3 * keySpacing + 2 * keyBorder);
                keyHeight = keySize * 1.33;
            }
            else{
                kHeight = kWidth * ratio;
                kTop = window.innerHeight - kHeight;
                keySize = kHeight / (4 * 1.33 + 3 * keySpacing + 2 * keyBorder);
                keyHeight = keySize * 1.33;
            }
                setLocation(k, kTop, kLeft);
                setSize(k, kHeight, kWidth);
                k.style.paddingTop = (keySize * keyBorder).toString() + "px";
                k.style.paddingLeft = (keySize * keyBorder).toString() + "px";
                let bk = document.getElementById("bonusKeys");
                let bkTop = kTop - keyHeight - keySpacing * keySize;
                let bkLeft = kLeft + 6 * keySize * (1 + keySpacing);
                setLocation(bk, bkTop, bkLeft);
                setSize(bk, keyHeight + keySize * keyBorder, 4 * keySize + 3 * keySize * keySpacing + 2 * keyBorder * keySize);
                bk.style.paddingTop = (keySize * keyBorder).toString() + "px";
                bk.style.paddingLeft = (keySize * keyBorder).toString() + "px";
                k.style.borderRadius = (keySize * 0.25).toString() + "px 0px 0px 0px";
                bk.style.borderRadius = (keySize * 0.25).toString() + "px " + (keySize * 0.25).toString() + "px 0px 0px";
            sizeKeys(keySize);
        }
        function sizeEndscreen(){
            e = document.getElementById("endscreen");
            setSize(e, pwHeight * 0.75, pwWidth * 0.75);
            e.style.borderRadius = (pwHeight * 0.01).toString() + "px";
            let word;
            let ht = Math.min(pwWidth * 0.75 / (14), pwHeight * 0.75 / 10.5);
            let hz;
            let letters;
            e.style.paddingTop = ((pwHeight * 0.75 - ht * 9.5) / 2).toString() + "px";
            e.style.boxSizing = "border-box";
            for (let i = 0; i < 5; i++){
                word = document.getElementById("word" + i.toString());
                letters = word.getElementsByClassName("letter");
                hz = letters.length;
                setSize(word, ht, ht * hz);
                word.style.position = "relative";
                word.style.left = ((pwWidth * 0.75 - ht * hz) / 2).toString() + "px";
                //word.style.top = "0px";
                for (letter of letters){
                    setSize(letter, ht, ht, 0);
                    letter.style.fontSize = (ht * 0.75).toString() + "px";
                }
            }
            document.getElementById("word4").style.marginBottom  = (ht / 2).toString() + "px";
            let lastWords = ["guessResult", "hintResult", "shareButton"];
            for (str of lastWords){
                word = document.getElementById(str);
                letters = word.getElementsByClassName("letter");
                hz = letters.length;
                setSize(word, ht, ht * hz);
                word.style.position = "relative";
                word.style.left = ((pwWidth * 0.75 - ht * hz) / 2).toString() + "px";
                //word.style.top = "0px";
                for (letter of letters){
                    setSize(letter, ht, ht, 0);
                    letter.style.fontSize = (ht * 0.75).toString() + "px";
                }
                word.style.marginBottom = (ht / 2).toString() + "px";
                if (str == "shareButton"){
                    word.style.left = ((pwWidth * 0.75 - ht * hz) / 2 - pwHeight * 0.01).toString() + "px";
                    word.style.top = (0 - pwHeight * 0.01).toString() + "px";
                }
            }
            let share = document.getElementById("shareButton");
            share.style.borderRadius = (pwHeight * 0.01).toString() + "px";
            share.style.borderWidth = (pwHeight * 0.01).toString() + "px";

            let ex = document.getElementById("endscreenX");
            setLocation(ex, 0, pwWidth * 0.75 - ht);
            setSize(ex, ht, ht);
            ex.style.fontSize = (ht * 0.75).toString() + "px";
        }
        function giveHint(){
            if (getCookie("gameOver") == "true"){
                return;
            }
            openMenu();
            let allguesses = getCookie("answerHistory").split("-");
            let bestguess = 0;
            let bestlength = 0;
            let truelength;
            for (let k in allguesses){
                truelength = allguesses[k].split("*").join("").length;
                //console.log(allguesses[k].split("*"));
                if (truelength > bestlength){
                    bestlength = truelength;
                    bestguess = k;
                }
            }
            let guessPieces = allguesses[bestguess].split("*");
            //console.log(allguesses[bestguess]);
            let beginning = guessPieces[0];
            let end = guessPieces.slice(1).join("");
            let helpful = beginning + goalSentence[beginning.length] + end + "2";
            let j = 0;
            let hstr = getCookie("hints");
            let hc;
            if (hstr == ""){
                hc = 0;
            }
            else{
                hc = parseInt(hstr);
            }
            setCookie("hints", (hc + 1).toString());
            let i = setInterval(function(){if (j >= helpful.length){clearInterval(i);} else{press(helpful[j]); j+= 1}}, 100);
        }
        function menuContents(){
            let hinttext = "<div id='menuHint' onclick='giveHint()'>";
            for (letter of "HINT"){
                hinttext += newLetter(letter, "noID");
            }
            hinttext += "</div>";

            //let rulestext = "<div id='menuRules'><a href='./rules.html'>";
            let rulestext = "<a id='menuRules'  href='./rules.html'>";
            for (letter of "RULES"){
                rulestext += newLetter(letter, "noID");
            }
            rulestext += "</a>";
            //rulestext += "</a></div>";

            let closetext = "<div id='menuClose' onclick='openMenu()'>";
            for (letter of "CLOSE"){
                closetext += newLetter(letter, "noID");
            }
            closetext += "</div>";
            return hinttext + rulestext + closetext;
        }
        function makeMenu(){
            let menu = document.getElementById("menu");
            if (menuOpen){
                menu.innerHTML = menuContents();
                if(getCookie("gameOver") == "true"){
                    document.getElementById("menuHint").style.opacity = "50%";
                }
                menu.style.animationName = "slide-left";
                menu.style.animationDuration = "0.5s";
                menu.style.animationFillMode = "both";
            }
            else{
                menu.innerHTML = "";
                menu.style.animationName = "";
            }
        }
        function redraw(){
            sideBySide = window.innerWidth > window.innerHeight;
            mbHeight = window.innerHeight / 10;
            pwHeight = window.innerHeight - window.innerHeight / 10;
            pwWidth = window.innerWidth;
            sizeMenuBar();
            sizeKeyboard();
            sizePlayWindow();
            sizeCurrentGuess();
            //console.log(document.getElementById("currentGuess").style.height);
            sizeHistory();
           
            if (getCookie("gameOver") == "true" && !endscreenClosed){
                sizeEndscreen();
            }
            
            sizeMenu();
            
            
        }
        function makeKeys(){
            let k = document.getElementById("keyboard");
            k.innerHTML = "";
            if (!keyboardCollapse){
                let str = "qwertyuiopasdfghjkl,zxcvbnm1234".toUpperCase();
                for (let i in str){
                    k.innerHTML += newButton(str[i]);
                }
            }
            k.innerHTML += newDiv("bonusKeys");
            let bk = document.getElementById("bonusKeys");
            str = "5?.!";
            for (let i in str){
                bk.innerHTML += newButton(str[i]);
            }
            document.getElementById("5").style.backgroundImage = "url(menudown.png)";
            document.getElementById("5").style.backgroundSize = "100%";
            document.getElementById("5").style.backgroundRepeat = "no-repeat";
            document.getElementById("5").style.backgroundPosition = "center";
            if (keyboardCollapse){
                document.getElementById("5").style.transform = "rotate(180deg)";
            }
        }
        function makeCurrentGuess(){
            let cg = document.getElementById("currentGuess");
            cg.innerHTML = "";
            for (let i in currentGuess){
                cg.innerHTML += newLetter(currentGuess[i], "guessLetter" + i.toString());
            }
            cg.innerHTML += newDiv("cursor");
        }
        function makeHistory(){
            let h = document.getElementById("history");
            h.innerHTML = "";
            let newColor;
            let firstWrong = getCookie("firstWrong").split("-");
            let answerHistory = getCookie("answerHistory").split("-");
            let guessHistory = getCookie("guessHistory").split("-");
            for (let i = answerHistory.length - 1; i > 0; i--){
                let guess = guessHistory[i];
                let answer = answerHistory[i];
                h.innerHTML += newDiv("guess" + i.toString());
                h.innerHTML += newDiv("answer" + i.toString());
                let g = document.getElementById("guess" + i.toString());
                g.className = "guessBox";
                let anim;
                let el;
                let delay = 0;
                for (let j in guess){
                    g.innerHTML += newLetter(guess[j], "guess" + i.toString() + "letter" + j.toString());
                    if (parseInt(firstWrong[i]) == j){ //red
                        newColor = "#631f1f";
                        document.getElementById( "guess"+ i.toString() + "letter" + j.toString()).style.color = "#B9D8C6"; // make text less intense
                    }
                    else if (parseInt(firstWrong[i]) < j){ //gray
                        newColor = "#404040";
                    }
                    else{ //green
                        newColor = "#218976";
                    }
                    
                    el = document.getElementById( "guess"+ i.toString() + "letter" + j.toString());
                    el.style.backgroundColor = newColor;
                    
                    if (i == answerHistory.length - 1){
                        //el.style.opacity = "0%";
                        
                        
                        if (parseInt(firstWrong[i]) < j){
                            el.style.animation = "appear";
                            el.style.animationDelay = (delay).toString() + "s";
                            el.style.animationFillMode = "both";
                            el.style.animationDuration = "1s";
                            delay += 0.05;
                        }
                        else if (parseInt(firstWrong[i]) == j){
                            el.style.animation = "appear, shake";
                            if (j == 0){
                                el.style.animationDelay = "0s, 0.5s";
                            }
                            else{
                                el.style.animationDelay = (0.9 + delay).toString() + "s, " + (1.4 + delay).toString() + "s";
                            }
                            el.style.animationFillMode = "both, both";
                            el.style.animationDuration = "0.5s, 0.66s";
                            //console.log("ye");
                            if (j == 0){
                                delay += 0.9;
                            }
                            else{
                                delay += 1.8;
                            }
                        }
                        else{
                            el.style.animation = "grow";
                            el.style.animationDelay = (0.05 * j).toString() + "s";
                            el.style.animationFillMode = "both";
                            el.style.animationDuration = "1s";
                            delay += 0.05;
                        }
                        
                    }
                }
                let a = document.getElementById("answer" + i.toString());
                a.className = "answerBox";
                for (let j in answer){
                    a.innerHTML += newLetter(answer[j], "answer" + i.toString() + "letter" + j.toString());
                    document.getElementById( "answer"+ i.toString() + "letter" + j.toString()).style.backgroundColor = "#218976";
                    if (answer[j] == "*"){
                        newColor = "#404040";
                    }
                    else{
                        newColor = "#218976";
                    }
                    document.getElementById( "answer"+ i.toString() + "letter" + j.toString()).style.backgroundColor = newColor;
                    if (i == answerHistory.length - 1){
                        document.getElementById( "answer"+ i.toString() + "letter" + j.toString()).style.animationName = "appear";
                        document.getElementById( "answer"+ i.toString() + "letter" + j.toString()).style.animationDelay = (delay + 0.9).toString() + "s";
                        document.getElementById( "answer"+ i.toString() + "letter" + j.toString()).style.animationFillMode = "both";
                        document.getElementById( "answer"+ i.toString() + "letter" + j.toString()).style.animationDuration = "1s";
                    }
                }
            }
        }
        function makeTitle(){
            let title = document.getElementById("title");
            let str = "SENTENCLE";
            for (let i in "SENTENCLE"){
                title.innerHTML += newLetter(str[i], "titleLetter" + i.toString());
            }
        }
        function openMenu(){
            menuOpen = !menuOpen;
            //console.log("opening...");
            if (!menuOpen){
                let m = document.getElementById("menu");
                //m.style.backgroundColor = "Orange";
                m.style.animationName = "leave-left";
                m.style.animationDelay = "0s";
                m.style.animationDuration = "0.5s";
                m.style.animationFillMode = "both";
                setTimeout(function(){
                    makeMenu();
                    redraw();
                }, 500);
            }
            else{
                makeMenu();
                redraw();
            }
            
        }
        function makeHamburger(){
            let hb = document.getElementById("hamburger");
            let slice;
            for (let i = 0; i < 3; i++){
                hb.innerHTML += newDiv("slice" + i.toString());
                slice = document.getElementById("slice" + i.toString());
                slice.style.backgroundColor = "#218976";
            }
        }
        function toggleSound(){
            SoundOn = !SoundOn;
            makeSoundButton();
        }
        function makeSoundButton(){
            let sb = document.getElementById("soundButton");
            if (SoundOn){
                sb.style.backgroundImage = "url(sound_on.png)";
            }
            else{
                sb.style.backgroundImage = "url(sound_off.png)";
            }
        }
        function makeMenuBar(){
            let mb = document.getElementById("menuBar");
            mb.innerHTML = newDiv("title");
            makeTitle();
            mb.innerHTML += "<div id='hamburger' onclick='openMenu()'></div>";
            makeHamburger();
            mb.innerHTML += newDiv("menu");
            mb.innerHTML += "<div id='soundButton' onclick='toggleSound()'></div>";
            makeSoundButton();
        }
        function copyResult(){
            let shareSentence = "I solved the ";
            shareSentence += parseInt(mm).toString() + "/" + parseInt(dd).toString();
            let g = (getCookie("guessHistory").split("-").length - 1).toString()
            shareSentence += " sentencle in " + g;
            if (g == "1"){
                shareSentence += " guess";
            }
            else{
                shareSentence += " guesses";
            }
            let h = getCookie("hints");
            if (h == "1"){
                shareSentence += " with 1 hint";
            }
            else if (h != "0"){
                shareSentence += " with " + h + " hints";
            }
            /*navigator.clipboard
            .writeText(shareSentence + ". viviandelphine.com/sentencle")
            .then(() => {
                //alert("successfully copied");
            })
            .catch(() => {
                alert("something went wrong");
            });*/
            try {
            navigator.share({ text: shareSentence + "!", url: "" });
                console.log("Data was shared successfully");
            } catch (err) {
                navigator.clipboard
                .writeText(shareSentence + "! viviandelphine.com/sentencle")
                .then(() => {
                    //alert("successfully copied");
                    let sb = document.getElementById("shareButton");
                    sb.innerHTML = "";
                    for (letter of "COPIED RESULT"){
                        sb.innerHTML += newLetter(letter);
                        sb.classList.remove("enticing");
                        sizeEndscreen();
                    }
                        let i = setInterval(function(){
                                sb.innerHTML = "";
                                for (letter of "SHARE"){
                                    sb.innerHTML += newLetter(letter);
                                }
                                for (letter of sb.getElementsByClassName("letter")){
                                    letter.style.backgroundColor = "#631f1f";
                                    letter.style.color = "#B9D8C6";
                                    sb.classList.add("enticing");
                                }
                                sizeEndscreen();
                                clearInterval(i);}, 1000);
                })
                .catch(() => {
                    alert("something went wrong");
                });
            }
            
            }
        function makeEndscreen(words){
            playSound(winJingle);
            let e = document.getElementById("endscreen");
            let word;
            let wo;
            for (let i in words){
                e.innerHTML += newDiv("word" + i.toString());
                word = words[i];
                wo = document.getElementById("word" + i.toString());
                for (let j in word){
                    wo.innerHTML += newLetter(word[j]);
                }
                if (i == 1 || i == 3 || i == 5){
                    wo.style.animationName = "slide-left";
                }
                else{
                    wo.style.animationName = "slide-right";
                }
                wo.style.animationDuration = "0.5s";
                wo.style.animationDelay = (0.5 * i).toString() +"s";
                wo.style.animationIterationCount = "1";
                wo.style.animationFillMode = "both";

            }
            e.innerHTML += newDiv("guessResult");
            let gr = document.getElementById("guessResult");
            let numGuesses = getCookie("guessHistory").split("-").length - 1;
            let plural = "ES";
            if (numGuesses == 1){
                plural = "";
            }
            for (letter of "IN " + numGuesses.toString() + " GUESS" + plural){
                gr.innerHTML += newLetter(letter);
            }
            gr.style.animationName = "appear";
            gr.style.animationDuration = "1s";
            gr.style.animationDelay = (0.5 * 5).toString() +"s";
            gr.style.animationIterationCount = "1";
            gr.style.animationFillMode = "both";

            e.innerHTML += newDiv("hintResult");
            let hr = document.getElementById("hintResult");
            let numHints = parseInt(getCookie("hints"));
            plural = "S";
            if (numHints == 1){
                plural = "";
            }
            for (letter of "WITH " + numHints.toString() + " HINT" + plural){
                hr.innerHTML += newLetter(letter);
            }

            hr.style.animationName = "appear";
            hr.style.animationDuration = "1s";
            hr.style.animationDelay = (0.5 * 6).toString() +"s";
            hr.style.animationIterationCount = "1";
            hr.style.animationFillMode = "both";

            e.innerHTML += "<div id=\"shareButton\" onclick='copyResult()'></div>";
            let sb = document.getElementById("shareButton");
            sb.style["touch-action"] = "manipulation";
            sb.style.borderStyle = "solid";
            sb.style.borderColor = "#B9D8C6";
            for (letter of "SHARE"){
                sb.innerHTML += newLetter(letter);
            }
            for (letter of sb.getElementsByClassName("letter")){
                letter.style.backgroundColor = "#631f1f";
                letter.style.color = "#B9D8C6";
            }

            sb.style.animationName = "appear";
            sb.style.animationDuration = "1s";
            sb.style.animationDelay = (0.5 * 7).toString() +"s";
            sb.style.animationIterationCount = "1";
            sb.style.animationFillMode = "both";
            sb.classList.add("enticing");
            //make the x to close
            e.innerHTML += "<div id='endscreenX' onclick='closeEndscreen()' class='letter'>x</div>";
            let ex = document.getElementById("endscreenX");
            ex.style.backgroundColor = "transparent";
        }
        function closeEndscreen(){
            endscreenClosed = true;
            document.getElementById("endscreen").innerHTML = "";
            document.getElementById("endscreen").style.height = "0px";
            document.getElementById("endscreen").style.borderRadius = "0px";
            document.getElementById("endscreen").style.borderWidth = "0px";
            document.getElementById("endscreen").style.paddingTop = "0px";
        }
        function makeAll(){
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)) {
                disableClicks();
            }
            menuOpen = false;
            if (parseInt(dd) > 29){
                goalSentence = "X X X X X.";
            }
            else{
                goalSentence = SentenceBank[parseInt(dd) - 1].toUpperCase();
            }
            if (getCookie("hints") == ""){
                setCookie("hints", "0");
            }
            document.body.innerHTML += newDiv("playWindow");
            let pw = document.getElementById("playWindow");
            pw.innerHTML += newDiv("history");
            makeHistory();
            pw.innerHTML += newDiv("currentGuess");
            makeCurrentGuess();
            pw.innerHTML += newDiv("keyboard");
            makeKeys();
            if (getCookie("gameOver") == "true" && endscreenClosed == false){
                pw.innerHTML += newDiv("endscreen");
                makeEndscreen(goalSentence.split(" "));
            }
            document.body.innerHTML += newDiv("menuBar");
            makeMenuBar();
            redraw();
        }
    </script>

</body>
</html>